if(typeof AnySignForPCExtension=="undefined"){AnySignForPCExtension={};}AnySignForPCExtension.AnySign=function(){var Q;var p;var F=null;var k={code:0,msg:""};var z=[];var d=[];var U=[];var e="general";var n=null;var I=false;var y=false;var M=AnySign.mAnySignSID;var J;var s;var T;var B;var D=0;var t;var v=AnySign.mBrowser.aName;var P=false;var E=0;var u=false;var f=0;var l=true;var x=0;var g=0;var h=0;var G=false;(new Function(GetSafeResponse(j("anySignjQuery-1.11.1.js"))))();function r(){console.log("[AnySign for PC][AnySign_reRun_02000]");if(p!=null){G=true;p.close();}p=null;I=false;F=null;AnySign.mAnySignLoad=false;var V=Q.substring(0,Q.length-5);Q=V+J;a();}function m(){if(I){console.log("[AnySign for PC][AnySign_error_10000]");try{var V=document.getElementById("xwup_title_guidewindow");if(V!=null){AnySign.mExtensionSetting.mDialog.oncancel();alert("[AnySign for PC] 보안 프로그램이 비정상적으로 동작하였습니다. 다시 실행하겠습니다.");}}catch(Z){console.log("try catch - document.getElementById xwup_title_guidewindow");}r();}else{if(P==true){console.log("[AnySign for PC][AnySign_error_10001]");var Y=new Date().getTime();if((Y-f)>120000){c(AnySign.mPlatform.aInstallPage);}else{setTimeout(r,2000);}}else{if(t=="FAILED"){console.log("[AnySign for PC][AnySign_error_10002]");return;}else{if(B==true){if(AnySign.mExtensionSetting.mInstallCheck_Level==1){console.log("[AnySign for PC][AnySign_error_10007]");AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){setTimeout(function(){if(AnySign.mExtensionSetting.mInstallCheck_CB){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}},100);}else{if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){AnySign.mExtensionSetting.mIgnoreInstallPage=true;var X;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){X=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{X=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(X){c(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}else{var aa;if(p.url){aa=p.url;}else{aa=p.URL;}console.log("[AnySign for PC][AnySign_error_10004]");B=false;S();}}else{var aa=null;if(T<AnySign.mExtensionSetting.mTrialPortRange){if(p.url){aa=p.url;}else{aa=p.URL;}var W="wss";J=J+2;T++;if(v=="explorer"){Q=W+"://127.0.0.1:"+J;}else{Q=W+"://localhost:"+J;}console.log("[AnySign for PC][AnySign_error_10005]["+J+"]");a();}else{AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";console.log("[AnySign for PC][AnySign_error_10006]");if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){setTimeout(function(){if(AnySign.mExtensionSetting.mInstallCheck_CB){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}},100);}else{if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){AnySign.mExtensionSetting.mIgnoreInstallPage=true;var X;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){X=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{X=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(X){c(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}}}}}}function a(){try{p=new WebSocket(Q);}catch(V){alert("[AnySign for PC] 통신채널 생성에 실패하였습니다.\n[웹소켓 에러 메세지] : "+V);}p.onopen=function(W){var X;if(p.url){X=p.url;}else{X=p.URL;}if(X.indexOf(J)<0||B==true){I=true;y=true;N();}else{setTimeout(O,30);}};p.onclose=function(W){if(v=="safari"){G=false;if(AnySign.mPlatform.aName.indexOf("mac")==0){if(u){if(E<2){E++;return;}u=false;E=0;}}m();}else{if(G==false){m();}else{G=false;}}};p.onmessage=function(aw){var X,Z,ae,Y,ad,ar,ap,at;var av=false;X=aw.data;try{Z=JSON.parse(X);aProtocolType=Z.protocolType;ae=Z.message;}catch(aw){B=false;J=Number(AnySign.mExtensionSetting.mPort)+1;s=J;r();return;}Y=ae.InterfaceName;ad=ae.ReturnType;ap=ae.MessageUID;at=ae.SessionID;if(ad=="number"){ar=Number(ae.ReturnValue);}else{ar=ae.ReturnValue;}k.code=ae.InterfaceErrorCode;k.msg=ae.InterfaceErrorMessage;if(k.code=="10000155"){alert("[AnySign for PC] ["+k.code+"] "+k.msg);}if(k.code=="21000"){if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_INTEGRITY_FAIL");}else{alert("[AnySign for PC] 공인인증 보안 프로그램의 동작을 중지합니다.\n악의적 공격에 의해 수정되었을 가능성이 있습니다.\n재설치 하시기 바랍니다.");c(AnySign.mPlatform.aInstallPage);}return;}switch(Y){case "launcher":if(k.code=="30000"||k.code=="30002"||k.code=="30003"||k.code=="30004"||k.code=="30005"){console.log("[AnySign for PC][AnySign_onmessage_01000]["+k.code+"]");D++;if(D>3){if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;return;}AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";var au;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){au=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{au=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(au){c(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;return;}if(k.code=="30002"&&AnySign.mPlatform.aName.indexOf("windows")==0){l=false;B=true;J=Number(AnySign.mExtensionSetting.mDirectPort)+1;s=J;r();}else{AnySign.mExtensionSetting.mImgIntervalError=true;var ac="[AnySign for PC] 서비스를 통한 AnySign4PC.exe 프로그램 실행에 실패하였습니다. 다시 실행하겠습니다.\n"+"["+k.code+"] ["+(new Function("ANYSIGN4PC_ERROR_"+k.code))()+"]";r();alert(ac);}}else{if(k.code=="30001"){console.log("[AnySign for PC][AnySign_onmessage_01001]");if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){G=true;p.close();setTimeout(function(){if(AnySign.mExtensionSetting.mInstallCheck_CB){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_UPDATE");AnySign.mExtensionSetting.mInstallCheck_CB=null;}},100);return;}if(AnySign.mAnySignLiveUpdate){if(P){var ag=new Date().getTime();if((ag-f)>120000){c(AnySign.mPlatform.aInstallPage);}else{setTimeout(O,2000);}}else{f=new Date().getTime();console.log("send message: updateready");b("updateready");}}else{AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){AnySign.mExtensionSetting.mIgnoreInstallPage=true;var au;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){au=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{au=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(au){c(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}else{if(k.code==0){var ax=ar.split(",");var ak=Q.substring(0,Q.length-5);s=ax[1];Q=ak+ax[1];console.log("[AnySign for PC][AnySign_onmessage_01002]["+s+"]");p=null;if(P&&AnySign.mPlatform.aName.indexOf("windows")==0){if(x<30){s=Number(AnySign.mExtensionSetting.mDirectPort)+1;Q=ak+s;x++;}setTimeout(a,2000);}else{a();}}else{if(AnySign.mPlatform.aName.indexOf("windows")==0&&k.code==20005){return;}AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";var au;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){au=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{au=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(au){c(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}break;case "setAttributeInfo":if(k.code==30006||k.code==30001){G=true;p.close();console.log("[AnySign for PC][AnySign_onmessage_01003]["+k.code+"]");B=false;y=false;S();return;}AnySign.mAnySignLoad=true;console.log("[AnySign for PC][AnySign_onmessage_01004]");if(k.code==20015){AnySign.mAnySignLoad=false;alert("[AnySign for PC] AnySign4PC.exe 프로그램 초기화에 실패하였습니다.\n"+"[실패 명령어] : "+k.msg);return;}if(ar.length==0){ar=null;}if(o(ar)!=0){AnySign.mAnySignLoad=false;I=false;t="FAILED";G=true;p.close();p=null;console.log("[AnySign for PC][AnySign_onmessage_01005]");return;}if(P){console.log("LiveUpdate success");P=false;if(v=="safari"&&AnySign.mPlatform.aName.indexOf("mac")==0){u=true;}}AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NORMAL";setTimeout(function(){if(document.getElementById("EncryptionAreaID_0")==null){AnySign.mPageBlockDecDone=true;q();}},1000);while(z[0]){var ai=n(z[0]);z.shift();R(ai);}if(AnySign.mExtensionSetting.mEncCallback){var ay=AnySign.mExtensionSetting.mEncCallback;AnySign.mExtensionSetting.mEncCallback="";ay();}if(AnySign.mExtensionSetting.mLoadCallback.func){var aj=AnySign.mExtensionSetting.mLoadCallback.func;var aa=AnySign.mExtensionSetting.mLoadCallback.param;AnySign.mExtensionSetting.mLoadCallback.func=null;AnySign.mExtensionSetting.mLoadCallback.param=null;aj(aa);}if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NORMAL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}break;case "blockDecEx":for(var af=0;af<d.length;af++){if(d[af].messageuid==ap){if(d[af].elementID){SofoAnySignJQuery("#"+d[af].elementID).append(ar);var W=d[af].elementID;var an=W.indexOf("_");var am=W.substring(an+1);var ah=parseInt(am)+1;g++;if(document.getElementById("EncryptionAreaID_"+ah)==null){h=ah;}if(g==h){AnySign.mPageBlockDecDone=true;}}if(d[af].funcObj){d[af].funcObj(ar,d[af].funcObjParam);}if(AnySign.mExtensionSetting.mPageDecCallback.length>0&&AnySign.mPageBlockDecDone==true){q();}d.splice(af,1);for(var al in z){if(z[al].MessageUID==ap){z.splice(al,1);for(var aq=0;aq<U.length-1;aq++){if(U[aq]==ap){U.splice(aq,1);break;}}}}}}break;case "blockEnc":case "blockEnc2":case "blockEncConvert2":if(F&&d.length==0){F(ar);}else{for(var af=0;af<d.length;af++){if(d[af].messageuid==ap){if(d[af].funcObjParam){d[af].funcObj(ar,d[af].funcObjParam);}else{d[af].funcObj(ar);}d.splice(af,1);for(var al in z){if(z[al].MessageUID==ap){z.splice(al,1);for(var aq=0;aq<U.length-1;aq++){if(U[aq]==ap){U.splice(aq,1);break;}}}}}}}break;case "updateready":console.log("receive message: updateready");if(k.code==0){var ao=document.getElementById("AnySign4PCLoadingImg");if(ao!=null){if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){ao.src=AnySign.mBasePath+"/img/loading_update.gif";}else{ao.src=AnySign.mBasePath+"/img/loading_update_en.gif";}}else{try{if(AnySign.mAnySignShowImg.showUpdateImg){AnySign.mExtensionSetting.mImgIntervalFunc=setInterval(function(){showAnySignLoadingImg("update");},50);}}catch(ab){console.log("try catch - showAnySignLoadingImg");}}P=true;console.log("send message: updatestart");b("updatestart");setTimeout(r,5000);}else{alert("[AnySign for PC] 보안 프로그램의 업데이트 설치에 실패하였습니다. 설치페이지로 이동합니다.\n"+"[오류코드] : "+k.code);c(AnySign.mPlatform.aInstallPage);}break;case "updatestart":console.log("receive message: updatestart");break;default:if(F){F(ar);}}};p.onerror=function(W){m();};}function R(V){if(p.readyState==0){setTimeout(function(){R(V);},500);}else{p.send(V);}}function K(W){var Y=W[0];var aa=W[W.length-1];var X=[];for(i=0;i<W.length-2;i++){X[i]=String(W[i+1]);}var V=String(W.length-2);var Z={InterfaceName:Y,ParameterLength:V,Parameter:X,MessageUID:aa,SessionID:M};return Z;}n=function(W){var V={protocolType:e,message:W,hash:""};return JSON.stringify(V);};function N(){var W=[];var X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);W.push("setAttributeInfo");if(l==false){W.push("put_CheckUserName="+l);}W.push("check_Version="+AnySign.mAnySignVersion);W.push("put_LicenseN="+AnySign.mLicense);if(AnySign.mLicense2){W.push("put_License2N="+AnySign.mLicense2);}W.push("put_StorageN="+AnySign.mStorage);if(AnySign.mSecurityContext){W.push("put_SecContextN="+AnySign.mSecurityContext);W.push("put_SecOptionN="+AnySign.mSecurityOption);}W.push("put_LanguageN="+AnySign.mLanguage);W.push("put_CharsetN="+AnySign.mCharset);W.push("put_ProxyUsageN="+AnySign.mProxyUsage);W.push("put_TransKeyN=");if(AnySign.mAnySignITGT){W.push("put_Integrity="+AnySign.mAnySignITGT);}W.push(X);var Y=K(W);var V=n(Y);R(V);}function O(){var W=[];var X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);W.push("launcher");if(AnySign.mBrowser.aSearchWord.indexOf("Edge")!=-1){W.push("edge");}else{W.push(v);}W.push(1);W.push(AnySign.mAnySignVersion);W.push(X);var Y=K(W);var V=JSON.stringify(Y);R(V);}function L(){var W=[];var X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);W.push("getVersionInfo");W.push("");W.push(X);var Y=K(W);var V=n(Y);R(V);}function b(Y){var W=[];var X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);W.push(Y);W.push(AnySign.mAnySignVersion);W.push(X);var Z=K(W);var V=n(Z);R(V);}function C(){return k.code;}function w(){return k.msg;}function H(){k.code="";k.msg="";}function A(){var X;var V=false;while(!V){X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);U.push(X);if(U.length==1){V=true;}for(var W=0;W<U.length-1;W++){if(U[W]==X){V=false;break;}else{V=true;}}if(V){break;}}return X;}function o(aa){if(AnySign.mAnySignITGT==""){return 0;}var X=-1;var V=new XMLHttpRequest();var W="";var Y="";var ab="";ab="SIGNED="+encodeURIComponent(aa);ab+="&ITGTVALUE="+AnySign.mAnySignITGT;ab+="&PORTVALUE="+s;Y=AnySign.mExtensionSetting.mIntegrityPageURL;V.open("POST",Y,false);V.setRequestHeader("Content-type","application/x-www-form-urlencoded");V.send(ab);try{W=(new Function(V.responseText))();if(parseInt(W["code"])!=0){AnySign.mExtensionSetting.mImgIntervalError=true;AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;return;}if(parseInt(W["code"])==-3){alert("[AnySign for PC] 공인인증 보안 프로그램의 무결성 검증에 실패하였습니다.\n악의적 공격에 의해 수정되었을 가능성이 있습니다.\n재설치 하시거나 관리자에게 문의해주시기 바랍니다.");}else{alert("[AnySign for PC] 공인인증 보안 프로그램 무결성 검증과정에서 오류가 발생하였습니다.\n재설치 하시거나 관리자에게 문의해주시기 바랍니다.\n[오류코드] : "+W["code"]+"\n"+"[오류메시지] : "+W["reason"]);}}else{X=0;}}catch(Z){alert("[AnySign for PC] 보안 프로그램 무결성 검증 메시지 처리과정에서 예외동작이 발생하였습니다.\n[예외처리 메시지] : "+Z+"\n[무결성 검증 응답 메시지] : "+V.responseText);}return X;}function j(Y){var W,V;if(window.ActiveXObject){try{W=new ActiveXObject("MSXML2.XMLHTTP.3.0");}catch(X){try{W=new ActiveXObject("Microsoft.XMLHTTP");}catch(X){console.log("try catch - new ActiveXObject");}}}else{if(window.XMLHttpRequest){W=new window.XMLHttpRequest;}}W.open("GET",AnySign.mBasePath+"/ext/"+Y,false);W.send(null);if(W.status!=200){alert("[AnySign for PC] 서버로부터 프로그램 실행을 위한 스크립트를 가져오는데 실패하였습니다.\n[스크립트 파일명] : "+Y);return;}return W.responseText;}function S(){B=false;J=Number(AnySign.mExtensionSetting.mPort)+1;if(v=="explorer"){Q="wss://127.0.0.1:"+J;}else{Q="wss://localhost:"+J;}T=0;a();}function q(){var Y=AnySign.mExtensionSetting.mPageDecCallback.length;for(var X=0;X<Y;X++){var V=AnySign.mExtensionSetting.mPageDecCallback[X].pageDecCallback;var W=AnySign.mExtensionSetting.mPageDecCallback[X].pageDecCallbackParam;if(W){console.log("[AnySign for PC][AnySign_executeDecCallback_03000]");V(W);}else{console.log("[AnySign for PC][AnySign_executeDecCallback_03001]");V();}}AnySign.mExtensionSetting.mPageDecCallback.splice(0,Y);}function c(V){if(V==undefined){return;}if(AnySign.mInstallPageNewOpen==true){window.open(V);}else{location.href=V;}}return{GetWebSocket:function(){if(AnySign.mPlatform.aName.indexOf("windows")==0){console.log("[AnySign for PC][AnySign_GetWebSocket_00001]");B=true;J=Number(AnySign.mExtensionSetting.mDirectPort)+1;s=J;if(v=="explorer"){Q="wss://127.0.0.1:"+J;}else{Q="wss://localhost:"+J;}a();}else{console.log("[AnySign for PC][AnySign_GetWebSocket_00002]");S();}},doSend:function(){var X=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint8Array(1))%99)+1;var W=Array.prototype.slice.call(arguments);W.push(X);var Y=K(W);var V=n(Y);R(V);},doAsyncSend:function(){var Y=Array.prototype.slice.call(arguments);var X=A();var W;if(Y[1]=="blockDecEx"){W={messageuid:X,elementID:Y[0],funcObj:Y[5],funcObjParam:Y[6]};}else{if(Y[1]=="blockEnc2"){W={messageuid:X,elementID:"",funcObj:Y[7],funcObjParam:Y[8]};}else{if(Y[1]=="blockEncConvert2"){W={messageuid:X,elementID:"",funcObj:Y[8],funcObjParam:Y[9]};}}}d.push(W);Y.shift();Y.push(X);var Z=K(Y);var V=n(Z);if(y){z.push(Z);R(V);}else{z.push(Z);}},setcallbackFunc:function(V){F=V;},getLastErrCode:function(){return C();},getLastErrMsg:function(){return w();},resetErrAndMsg:function(){H();},resetcallbackFunc:function(){F=null;}};};
