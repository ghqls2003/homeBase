var Integrity=function(){var integrityOption={JSFileCheck:false,FuncCheck:true,initObject:["XCrypto","AnySign.mAnySignForPC"],FuncObjectError:"function changed",FuncObjectReg:{XCrypto:"crypto\\(\\).([A-Za-z0-9_]+)[\\s|(]","AnySign.mAnySignForPC":"mAnySignForPC.([A-Za-z0-9_]+)[\\s|(]"},DOMCheck:true,DOMErrorType:"alert",ScriptLog:true,integrityLogFileName:"AnySignLiteLog.txt",verifyFileList:{"/ext/xcrypto_min.js":"10454b5454a1ec9b4bb1d76678d0da673b1bd76a4c0eec564cdcf2442c93ed2e","/ext/xcryptoCore_min.js":"35c75ef4166e576dc4561ab70265e9c019f6ef28a22c849a834a0caba7bf2f81","/ext/FileSaver.min.js":"ff9a5da866f71b9ab01a7c67b6ecaa7f0ad156add37aab0518a620a5741aba9a"}};var js_errorCallback=function(message){console.log(message)};var dom_errorCallback=function(message){alert(message)};var func_errorCallback=function(message){alert(message)};var certmanager={xwup_media_localstorage:["id"],xwup_media_hdd:["id"],xwup_media_removable:["id"],xwup_media_savetoken:["id"],xwup_media_pkcs11:["id"],xwup_media_mobile:["id"]};var certselect={xwup_certselect_lite_input1:["id","name","type"],xwup_OkButton:["id"],xwup_cert_table:["id"]};var changepasswd={xwup_changepasswd_tek_input1:["id","type"],xwup_changepasswd_tek_input2:["id","type"],xwup_changepasswd_tek_input3:["id","type"]};var fileselect={xwup_filelist:["id"]};var inputpasswd={xwup_inputpasswd_tek_input1:["id","name","type"]};var pfxdialog={xwup_dragZone:["id"]};var mutationEnable,funcOriginList=[],funcOriginObj,IntegrityLog=[];_leadingZeros=function(n,digits){var zero="";n=n.toString();if(n.length<digits){for(i=0;i<digits-n.length;i++)zero+="0"}return zero+n};_getTimeStamp=function(){var d=new Date;var s=_leadingZeros(d.getFullYear(),4)+"-"+_leadingZeros(d.getMonth()+1,2)+"-"+_leadingZeros(d.getDate(),2)+" "+_leadingZeros(d.getHours(),2)+":"+_leadingZeros(d.getMinutes(),2)+":"+_leadingZeros(d.getSeconds(),2);return s};_startLogging=function(obj){if(obj)IntegrityLog=obj;IntegrityLog.push("["+_getTimeStamp()+"] Logging start.\r\n")};_stopLogging=function(){var blob=new Blob(IntegrityLog,{type:"text/plain;charset=utf-8"});saveAs(blob,integrityOption.integrityLogFileName);IntegrityLog=[]};_clone=function(obj){var copy;if(null==obj||"object"!=typeof obj)return obj;if(obj instanceof Date){copy=new Date;copy.setTime(obj.getTime());return copy}if(obj instanceof Array){copy=[];for(var i=0,len=obj.length;i<len;i++){copy[i]=_clone(obj[i])}return copy}if(obj instanceof Object){copy={};for(var attr in obj){if(obj.hasOwnProperty(attr))copy[attr]=_clone(obj[attr])}return copy}throw new Error("Unable to copy obj! Its type isn't supported.")};_addEventListener=function(module){for(m in module){var id=m.toString();var option=function(){return eval("module."+id)}();var targetObject=document.getElementById(id);(function(value){targetObject.addEventListener("DOMAttrModified",function(e){if(AnySign.mAnySignEnable)return;if(value.indexOf(e.attrName)!=-1){var strings="";strings+="["+_getTimeStamp()+"] ";strings+=targetObject.tagName+"노드의 "+e.attrName+'속성이 "'+e.prevValue+'"에서 "'+e.newValue+'"으로 변경됨';strings+="\r\n";if(integrityOption.DOMErrorType=="log"){IntegrityLog.push(strings)}else{dom_errorCallback(strings)}}},false)})(option)}};_addObserver=function(module){for(m in module){var id=m.toString();var option=function(){return eval("module."+id)}();var targetObject=document.getElementById(id);if(targetObject!=null){observerObject.observe(targetObject,{attributes:true,attributeFilter:option,attributeOldValue:true})}}};_initFunc=function(){for(var i=0;i<integrityOption.initObject.length;i++){var obj=function(){return eval(integrityOption.initObject[i])}();funcOriginList[integrityOption.initObject[i]]=_clone(obj)}};_initJSFile=function(){var fileList=integrityOption.verifyFileList;for(m in fileList){_loadScript(m,fileList[m])}};_getFuncName=function(obj,strings){var aRegExp,aFuncName,aRet="";if(integrityOption.FuncObjectReg){aRegExp=new RegExp(integrityOption.FuncObjectReg[obj]);aFuncName=strings.match(aRegExp);if(aFuncName)aRet=aFuncName[1]}return aRet};_checkIntegrity=function(obj,name,type){var aName;if(type){aName=_getFuncName(obj,name);if(aName==""){console.log("[integrity] _checkIntegrity error: empty name");return false}}else{aName=name}var orifuncS=function(){var value=eval('funcOriginList["'+obj+'"].'+aName);if(typeof value=="undefined")return"not function";return eval('funcOriginList["'+obj+'"].'+aName)}();if(orifuncS=="not function"){console.log("[integrity] _checkIntegrity error: not function");return true}var funcS=function(){return eval(obj+"."+aName)}();if(orifuncS!=funcS){func_errorCallback("["+aName+"] "+integrityOption.FuncObjectError);return false}return true};mutationObjectCallback=function(mutationRecordsList){mutationRecordsList.forEach(function(mutationRecord){if(AnySign.mAnySignEnable)return;var target=mutationRecord.target;var oldValueInfo,curValueInfo;oldValueInfo='"'+mutationRecord.oldValue+'"에서';curValueInfo='"'+target.getAttribute(mutationRecord.attributeName)+'"으로';var strings="";strings+="["+_getTimeStamp()+"] ";strings+=target.nodeName+"노드의 "+mutationRecord.attributeName+"속성이 "+oldValueInfo+" "+curValueInfo+" 변경됨";strings+="\r\n";if(integrityOption.DOMErrorType=="log"){IntegrityLog.push(strings)}else{dom_errorCallback(strings)}})};try{mutationEnable=true;var observerObject=new MutationObserver(mutationObjectCallback)}catch(e){mutationEnable=false}_loadScript=function(name){var xhttp=new XMLHttpRequest;xhttp.onreadystatechange=function(){try{if(xhttp.readyState==4&&xhttp.status==200){var resultHash=XCrypto.hashData(2,xhttp.responseText,0);if(resultHash!=integrityOption.verifyFileList[name])js_errorCallback("[integrity] "+name+" file diff");else js_errorCallback("[integrity] "+name+" file same")}}catch(e){console.log("[integrity] _loadScript error: "+e)}};var path=AnySign.mBasePath+name;xhttp.open("GET",path,false);xhttp.send(null)};_getIntegrityOption=function(){return integrityOption.FuncCheck};if(typeof XCrypto=="undefined"){console.log("XCrypto undefined");return}if(integrityOption.ScriptLog)_startLogging();if(integrityOption.JSFileCheck)_initJSFile();if(integrityOption.FuncCheck)_initFunc();return{setObserver:function(moduleName){try{var isFileSaverSupported=!!new Blob}catch(e){return}var module=function(){return eval(moduleName)}();if(mutationEnable){_addObserver(module)}else{_addEventListener(module)}},checkIntegrity:function(obj,name,type){if(integrityOption.FuncCheck){if(type){return _checkIntegrity(obj,name,1)}else{return _checkIntegrity(obj,name,0)}}else{return true}},startLogging:function(obj){_startLogging(obj)},stopLogging:function(){_stopLogging()}}}();