if(typeof AnySignForPCExtension=="undefined"){AnySignForPCExtension={};}AnySignForPCExtension.AnySignAjax=function(){var ad;var R=null;var P=null;var r={code:0,msg:""};var K=[];var j=[];var k="general";var u=null;var H=null;var T=false;var E=0;var O=0;var x;var Z=true;var Q=null;var F=null;var q=null;var t="heartbeat!";var N=30000;var I=20000;var v;var X=300;var p=200;var d=230;var c=0;var B=0;var Y=AnySign.mAnySignSID;var L=false;var af;var W;var A;var e=false;var G=0;var U=false;var h=[];var ac=false;var l=0;var C;var s=true;var m=0;var n=0;(new Function(GetSafeResponse(o("SecureProto.js"))))();(new Function(GetSafeResponse(o("anySignjQuery-1.11.1.js"))))();function o(ak){var ai,ah;if(window.ActiveXObject){try{ai=new ActiveXObject("MSXML2.XMLHTTP.3.0");}catch(aj){try{ai=new ActiveXObject("Microsoft.XMLHTTP");}catch(aj){console.log("try catch - new ActiveXObject");}}}else{if(window.XMLHttpRequest){ai=new window.XMLHttpRequest;}}ai.open("GET",AnySign.mBasePath+"/ext/"+ak,false);ai.send(null);if(ai.status!=200){alert("[AnySign for PC] 서버로부터 프로그램 실행을 위한 스크립트를 가져오는데 실패하였습니다.\n[스크립트 파일명] : "+ak);return;}return ai.responseText;}function g(){var ah=new Date().getTime();if((ah-v)>I){if(Z){if(F!=null){if(F!=t||Q!=q){clearInterval(x);Q=null;F=null;q=null;a();}}if(Z){q=ag(t,d);}}}}function z(){console.log("[AnySign for PC][AnySignAjax_reRun_02000]");webSocket=null;T=false;e=false;AnySign.mAnySignLoad=false;var ah=ad.substring(0,ad.length-5);ad=ah+W;a();}function a(){R=new XDomainRequest();if(!e&&L==false){var ah=aa();setTimeout(function(){ae(ah);},300);}else{if(ad.indexOf("https:")==0){ab(X);}else{if(ad.indexOf("http:")==0){Secure.start("envelope",D);}}}R.onload=function(){var aj,al,aq,ak,ap,ay,ax,az;var aB=false;v=new Date().getTime();Z=true;aj=R.responseText;try{al=JSON.parse(aj);aProtocolType=al.protocolType;aq=al.message;}catch(aC){L=false;var at=Number(AnySign.mExtensionSetting.mPort);if(window.location.protocol.indexOf("https:")==0){W=at+1;ad="https://127.0.0.1:"+W;}else{W=at;ad="http://127.0.0.1:"+W;}A=W;z();return;}if(aProtocolType=="secure"){AnySign.mExtensionSetting.mImgIntervalError=true;alert("[AnySign for PC] Internet Explorer 9 이하 버전에서는 Secure 보안프로토콜이 동작하지 않습니다.");return;}if(aProtocolType=="envelope"){try{aMessageType=aq.messageType;switch(aMessageType){case "application":aq=JSON.parse(Secure.receiveApplication(al));break;case "server_hello":if(Secure.handShake(D,al)){k="envelope";H=u;u=function(aF){var aG=JSON.stringify(aF);return Secure.sendApplication(aG);};ab(p);}else{alert("[AnySign for PC] Envelope 보안프로토콜 암호세션 생성이 실패하였습니다.\n\n보안프로토콜 인증서가 유효하지 않습니다. 다시 암호세션 생성을 시도하겠습니다.");a();}return;default:alert("[AnySign for PC] Envelope 보안프로토콜이 정상적으로 동작하지 않았습니다.\n[메시지 코드] : "+aq.code);return;}}catch(an){alert("[AnySign for PC] Envelope 보안프로토콜에 예외동작이 발생하였습니다.\n[예외처리 메시지] : "+an);}}ak=aq.InterfaceName;ap=aq.ReturnType;ax=aq.MessageUID;az=aq.SessionID;if(ap=="number"){ay=Number(aq.ReturnValue);}else{ay=aq.ReturnValue;}r.code=aq.InterfaceErrorCode;r.msg=aq.InterfaceErrorMessage;if(r.code=="10000155"){alert("[AnySign for PC] ["+r.code+"] "+r.msg);}if(r.code=="21000"){if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_INTEGRITY_FAIL");}else{alert("[AnySign for PC] 공인인증 보안 프로그램의 동작을 중지합니다.\n악의적 공격에 의해 수정되었을 가능성이 있습니다.\n재설치 하시기 바랍니다.");f(AnySign.mPlatform.aInstallPage);}return;}switch(ak){case "launcher":if(r.code=="30000"||r.code=="30002"||r.code=="30003"||r.code=="30004"||r.code=="30005"){console.log("[AnySign for PC][AnySignAjax_onload_01000]["+r.code+"]");O++;if(O>3){if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;return;}AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";var aA;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){aA=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{aA=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(aA){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;return;}if(r.code=="30002"&&AnySign.mPlatform.aName.indexOf("windows")==0){s=false;L=true;W=Number(AnySign.mExtensionSetting.mDirectPort)+1;A=W;z();}else{AnySign.mExtensionSetting.mImgIntervalError=true;var ao="[AnySign for PC] 서비스를 통한  AnySign4PC.exe 프로그램 실행에 실패하였습니다. 다시 실행하겠습니다.\n"+"["+r.code+"] ["+(new Function("ANYSIGN4PC_ERROR_"+r.code))()+"]";alert(ao);}return;}else{if(r.code=="30001"){console.log("[AnySign for PC][AnySignAjax_onload_01001]");if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_UPDATE");AnySign.mExtensionSetting.mInstallCheck_CB=null;return;}if(AnySign.mAnySignLiveUpdate){if(ac){var ar=new Date().getTime();if((ar-l)>120000){f(AnySign.mPlatform.aInstallPage);}else{setTimeout(function(){z();},2000);}}else{var aw=document.getElementById("AnySign4PCLoadingImg");if(aw!=null){if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){aw.src=AnySign.mBasePath+"/img/loading_update.gif";}else{aw.src=AnySign.mBasePath+"/img/loading_update_en.gif";}}else{try{if(AnySign.mAnySignShowImg.showUpdateImg){AnySign.mExtensionSetting.mImgIntervalFunc=setInterval(function(){showAnySignLoadingImg("update");},50);}}catch(an){console.log("try catch - showAnySignLoadingImg");}}l=new Date().getTime();ac=true;console.log("[AnySign4PC] send message: updateready");b("updateready");}}else{AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){var aA;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){aA=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{aA=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(aA){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}else{if(r.code==0){if(ac){ac=false;}T=true;e=true;var aD=ay.split(",");var av=ad.substring(0,ad.length-5);if(av.indexOf("https:")==0){A=aD[1];ad=av+aD[1];}else{A=aD[0];ad=av+aD[0];}console.log("[AnySign for PC][AnySignAjax_onload_01002]["+A+"]");a();}else{AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";var aA;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){aA=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{aA=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(aA){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}break;case "setAttributeInfo":if(r.code==30006||r.code==30001){console.log("[AnySign for PC][AnySignAjax_onload_01003]["+r.code+"]");L=false;at=Number(AnySign.mExtensionSetting.mPort);if(window.location.protocol.indexOf("https:")==0){W=at+1;ad="https://127.0.0.1:"+W;}else{if(r.code==30001){u=H;}W=at;ad="http://127.0.0.1:"+W;}z();return;}AnySign.mAnySignLoad=true;console.log("[AnySign for PC][AnySignAjax_onload_01004]");if(r.code==20015){AnySign.mAnySignLoad=false;alert("[AnySign for PC] AnySign4PC.exe 프로그램 초기화에 실패하였습니다.\n"+"[실패 명령어] : "+r.msg);return;}if(ay.length==0){ay=null;}if(w(ay)!=0){AnySign.mAnySignLoad=false;T=false;C="FAILED";console.log("[AnySign for PC][AnySignAjax_onload_01005]");return;}AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NORMAL";if(document.getElementById("EncryptionAreaID_0")==null){AnySign.mPageBlockDecDone=true;y();}if(AnySign.mExtensionSetting.mEncCallback){var aE=AnySign.mExtensionSetting.mEncCallback;AnySign.mExtensionSetting.mEncCallback="";aE();}if(AnySign.mExtensionSetting.mLoadCallback.func){var au=AnySign.mExtensionSetting.mLoadCallback.func;var am=AnySign.mExtensionSetting.mLoadCallback.param;AnySign.mExtensionSetting.mLoadCallback.func=null;AnySign.mExtensionSetting.mLoadCallback.param=null;au(am);}if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NORMAL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}x=setInterval(g,N);U=true;break;case "pong":Q=ax;F=ay;break;case "blockDecEx":h.push(aq);U=true;break;case "blockEnc":case "blockEnc2":case "blockEncConvert2":if(P){var ai=P;P=null;ai(ay);}else{h.push(aq);U=true;}break;case "updateready":console.log("[AnySign4PC] receive message: updateready");if(r.code==0){console.log("[AnySign4PC] send message: updatestart");b("updatestart");}else{alert("[AnySign for PC] 보안 프로그램의 업데이트 설치에 실패하였습니다. 설치페이지로 이동합니다.\n"+"[오류코드] : "+r.code);f(AnySign.mPlatform.aInstallPage);}break;case "updatestart":console.log("[AnySign4PC] receive message: updatestart");setTimeout(z,c);break;default:if(P){var ai=P;P=null;ai(ay);}}};R.onerror=function(){if(T){console.log("[AnySign for PC][AnySignAjax_error_10000]");if(x){clearInterval(x);}if(E>3){AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";var ak=confirm("안정적인 동작을 위해 AnySign for PC 공인인증 보안 프로그램의 재설치가 필요합니다.\n[확인]을 선택하시면 설치페이지로 연결됩니다.");if(ak){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;return;}try{var ai=document.getElementById("xwup_title_guidewindow");if(ai!=null){AnySign.mExtensionSetting.mDialog.oncancel();}}catch(am){console.log("try catch - document.getElementById xwup_title_guidewindow");}E++;z();}else{if(ac==true){console.log("[AnySign for PC][AnySignAjax_error_10001]");var al=new Date().getTime();if((al-l)>120000){f(AnySign.mPlatform.aInstallPage);}else{z();}}else{if(C=="FAILED"){console.log("[AnySign for PC][AnySignAjax_error_10002]");return;}else{if(L){if(AnySign.mExtensionSetting.mInstallCheck_Level==1){console.log("[AnySign for PC][AnySignAjax_error_10007]");AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}else{if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){var ak;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){ak=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{ak=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(ak){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}else{L=false;af=0;port=Number(AnySign.mExtensionSetting.mPort);if(window.location.protocol.indexOf("https:")==0){W=port+1;ad="https://127.0.0.1:"+W;}else{W=port;ad="http://127.0.0.1:"+W;}console.log("[AnySign for PC][AnySignAjax_error_10004]");z();}}else{if(af<AnySign.mExtensionSetting.mTrialPortRange){var aj;if(window.location.protocol.indexOf("https:")==0){aj="https://127.0.0.1:";}else{aj="http://127.0.0.1:";}W=W+2;ad=aj+W;console.log("[AnySign for PC][AnySignAjax_error_10005]["+W+"]");af++;a();}else{console.log("[AnySign for PC][AnySignAjax_error_10006]");AnySign.mExtensionSetting.mInstallCheck_State="ANYSIGN4PC_NEED_INSTALL";if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}else{if(AnySign.mExtensionSetting.mIgnoreInstallPage!=true){var ak;if(typeof AnySign.mLanguage==="string"&&AnySign.mLanguage.toLowerCase()=="ko-kr"){ak=confirm(AnySign.mExtensionSetting.mInstallMsg_KR);}else{ak=confirm(AnySign.mExtensionSetting.mInstallMsg_EN);}if(ak){f(AnySign.mPlatform.aInstallPage);}AnySign.mExtensionSetting.mImgIntervalError=true;}}}}}}}};R.ontimeout=function(){};R.onprogress=function(){};R.timeout=B;}function ae(ah){Z=false;R.open("POST",ad);R.send(ah);}function D(ah,ai){Z=false;if(ai===undefined){setTimeout(function(){ae(ah);},X);}else{setTimeout(function(){ae(ah);},ai);}}function V(ai){var ak=ai[0];var am=ai[ai.length-1];var aj=[];for(i=0;i<ai.length-2;i++){aj[i]=String(ai[i+1]);}var ah=String(ai.length-2);var al={InterfaceName:ak,ParameterLength:ah,Parameter:aj,MessageUID:am,SessionID:Y};return al;}u=function(ai){var ah={protocolType:k,message:ai,hash:""};return JSON.stringify(ah);};function ab(al){var ai=[];var aj=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);ai.push("setAttributeInfo");if(s==false){ai.push("put_CheckUserName="+s);}ai.push("check_Version="+AnySign.mAnySignVersion);ai.push("put_LicenseN="+AnySign.mLicense);if(AnySign.mLicense2){ai.push("put_License2N="+AnySign.mLicense2);}ai.push("put_StorageN="+AnySign.mStorage);if(AnySign.mSecurityContext){ai.push("put_SecContextN="+AnySign.mSecurityContext);ai.push("put_SecOptionN="+AnySign.mSecurityOption);}ai.push("put_LanguageN="+AnySign.mLanguage);ai.push("put_CharsetN="+AnySign.mCharset);ai.push("put_ProxyUsageN="+AnySign.mProxyUsage);ai.push("put_TransKeyN=");if(AnySign.mAnySignITGT){ai.push("put_Integrity="+AnySign.mAnySignITGT);}ai.push(aj);var ak=V(ai);var ah=u(ak);D(ah,al);}function aa(al){var ai=[];var aj=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);ai.push("launcher");ai.push(AnySign.mBrowser.aName);ai.push(1);ai.push(AnySign.mAnySignVersion);ai.push(aj);var ak=V(ai);var ah=JSON.stringify(ak);return ah;}function ag(am,al){var ai=[];var aj=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);ai.push("ping");ai.push(am);ai.push(aj);var ak=V(ai);var ah=u(ak);D(ah,al);return aj;}function b(ak){var ai=[];var aj=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);ai.push(ak);ai.push(AnySign.mAnySignVersion);ai.push(aj);var al=V(ai);var ah=u(al);D(ah);}function M(){return r.code;}function J(){return r.msg;}function S(){r.code="";r.msg="";}function w(am){if(AnySign.mAnySignITGT==""){return 0;}var aj=-1;var ah=new XMLHttpRequest();var ai="";var ak="";var an="";an="SIGNED="+encodeURIComponent(am);an+="&ITGTVALUE="+AnySign.mAnySignITGT;an+="&PORTVALUE="+A;ak=AnySign.mExtensionSetting.mIntegrityPageURL;ah.open("POST",ak,false);ah.setRequestHeader("Content-type","application/x-www-form-urlencoded");ah.send(an);try{ai=(new Function(ah.responseText))();if(parseInt(ai["code"])!=0){AnySign.mExtensionSetting.mImgIntervalError=true;if(AnySign.mExtensionSetting.mInstallCheck_CB!=null){AnySign.mExtensionSetting.mInstallCheck_CB("ANYSIGN4PC_NEED_INSTALL");AnySign.mExtensionSetting.mInstallCheck_CB=null;}if(parseInt(ai["code"])==-3){alert("[AnySign for PC] 공인인증 보안 프로그램의 무결성 검증에 실패하였습니다.\n악의적 공격에 의해 수정되었을 가능성이 있습니다.\n재설치 하시거나 관리자에게 문의해주시기 바랍니다.");}else{alert("[AnySign for PC] 공인인증 보안 프로그램 무결성 검증과정에서 오류가 발생하였습니다.\n재설치 하시거나 관리자에게 문의해주시기 바랍니다.\n[오류코드] : "+ai["code"]+"\n"+"[오류메시지] : "+ai["reason"]);}}else{aj=0;}}catch(al){alert("[AnySign for PC] 보안 프로그램 무결성 검증 메시지 처리과정에서 예외동작이 발생하였습니다.\n[예외처리 메시지] : "+al+"\n[무결성 검증 응답 메시지] : "+ah.responseText);}return aj;}Array.prototype.removeElement=function(ah){this.splice(ah,1);return this;};function y(){var ak=AnySign.mExtensionSetting.mPageDecCallback.length;for(var aj=0;aj<ak;aj++){var ah=AnySign.mExtensionSetting.mPageDecCallback[aj].pageDecCallback;var ai=AnySign.mExtensionSetting.mPageDecCallback[aj].pageDecCallbackParam;if(ai){console.log("[AnySign for PC][AnySignAjax_executeDecCallback_03000]");ah(ai);}else{console.log("[AnySign for PC][AnySignAjax_executeDecCallback_03001]");ah();}}AnySign.mExtensionSetting.mPageDecCallback.splice(0,ak);}function f(ah){if(ah==undefined){return;}if(AnySign.mInstallPageNewOpen==true){window.open(ah);}else{location.href=ah;}}return{GetWebSocket:function(){var ah;if(AnySign.mPlatform.aName.indexOf("windows")!=0){console.log("[AnySign for PC][AnySignAjax_GetWebSocket_00002]");af=0;ah=Number(AnySign.mExtensionSetting.mPort);}else{console.log("[AnySign for PC][AnySignAjax_GetWebSocket_00001]");L=true;ah=Number(AnySign.mExtensionSetting.mDirectPort);}if(window.location.protocol.indexOf("https:")==0){W=ah+1;ad="https://127.0.0.1:"+W;}else{W=ah;ad="http://127.0.0.1:"+W;}if(AnySign.mPlatform.aName.indexOf("windows")==0){A=W;}e=false;a();},doSend:function(){var aj=new Date().getTime()+parseInt((window.crypto||window.msCrypto).getRandomValues(new Uint16Array(1))%999);var ai=Array.prototype.slice.call(arguments);ai.push(aj);var ak=V(ai);var ah=u(ak);D(ah,c);},doAsyncSend:function(){var ai=Array.prototype.slice.call(arguments);var ah=G++;if(ai[1]=="blockDecEx"){aDecObj={messageuid:ah,elementID:ai[0],funcObj:ai[5],funcObjParam:ai[6]};}else{if(ai[1]=="blockEnc2"){aDecObj={messageuid:ah,elementID:"",funcObj:ai[7],funcObjParam:ai[8]};}else{if(ai[1]=="blockEncConvert2"){aDecObj={messageuid:ah,elementID:"",funcObj:ai[8],funcObjParam:ai[9]};}}}ai.shift();ai.push(ah);var aj=V(ai);K.push(aj);var ak=setInterval(function(){if(U){if(K.length!=0){U=false;var al=u(K[0]);K.shift();ae(al);}}for(var ap=0;ap<h.length;ap++){for(var ao=0;ao<j.length;ao++){if(h[ap].MessageUID==j[ao].messageuid){clearInterval(ak);if(j[ao].elementID){SofoAnySignJQuery("#"+j[ao].elementID).append(h[ap].ReturnValue);var an=j[ao].elementID;var ar=an.indexOf("_");var aq=an.substring(ar+1);var am=parseInt(aq)+1;m++;if(document.getElementById("EncryptionAreaID_"+am)==null){n=am;}if(m==n){AnySign.mPageBlockDecDone=true;}}if(j[ao].funcObj){j[ao].funcObj(h[ap].ReturnValue,j[ao].funcObjParam);}if(AnySign.mExtensionSetting.mPageDecCallback.length>0&&AnySign.mPageBlockDecDone==true){y();}j.removeElement(ao);h.removeElement(ap);break;}}}},10);j.push(aDecObj);},setcallbackFunc:function(ah){P=ah;},getLastErrCode:function(){return M();},getLastErrMsg:function(){return J();},resetErrAndMsg:function(){S();},resetcallbackFunc:function(){P=null;}};};
