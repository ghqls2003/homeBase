<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="stts.carStts">

	<!-- 대여차량 차종 -->
	<select id="carmdl" parameterType="paraMap" resultType="resultMap">
	/* 대여차량 차종 */
		SELECT COALESCE(car.carmdl, '-') carmdl
			, COALESCE(COUNT(*), 0) count
		FROM
			dqvs.dvs_rac_mt_car car
		GROUP BY car.carmdl
	</select>
	
	<!-- 대여차량 연식 -->
	<select id="mdlyr" parameterType="paraMap" resultType="resultMap">
	/* 대여차량 연식 */	
		SELECT COALESCE(car.mdlyr, '-') mdlyr
			, COALESCE(COUNT(*), 0) count
		FROM
			dqvs.dvs_rac_mt_car car
		WHERE car.use_yn = 'Y'
		GROUP BY car.mdlyr
<!-- 		ORDER BY car.mdlyr DESC -->
	</select>	

	<!-- 법인별 대여차량 -->
	<select id="crprtnData" parameterType="paraMap" resultType="resultMap">
	/* 법인별 대여차량 */
		SELECT m.co_nm
			, TO_CHAR(m.sdn, 'FM999,999,999') sdn
			, TO_CHAR(m.suv, 'FM999,999,999') suv
			, TO_CHAR(m.etc, 'FM999,999,999') etc
			, TO_CHAR(m.sdn+m.suv+m.etc, 'FM999,999,999') tot
			, m.crno
		FROM
			(
			SELECT COALESCE(t.co_nm, '합계') co_nm
				, SUM(CASE WHEN car.carmdl = '승용' THEN 1 ELSE 0 END) sdn
				, SUM(CASE WHEN car.carmdl = '승합' THEN 1 ELSE 0 END) suv
				, SUM(CASE WHEN car.carmdl != '승용' AND car.carmdl != '승합' AND NOT car.carmdl ISNULL THEN 1 ELSE 0 END) etc
				, t.crno
			FROM
				(
				SELECT DISTINCT ON (mstr.crno) mstr.crno
					, mstr.co_nm
					, mstr.bzmn_sn 
				FROM
					dqvs.dvs_rac_mt_agency mstr
				WHERE mstr.up_brno ISNULL AND mstr.offi_sn IN(NULL, '1')
					AND mstr.bsn_stts_cd = '0'
				) AS t
			LEFT OUTER JOIN
				dqvs.dvs_rac_mt_car car
			ON t.crno = car.crno AND car.use_yn = 'Y'
			GROUP BY ROLLUP((t.co_nm, t.bzmn_sn, t.crno))
			ORDER BY t.bzmn_sn 
			) AS m
	</select>
	
	<!-- 대여차량 목록 -->
	<select id="crprtnCarData" parameterType="paraMap" resultType="resultMap">
	/* 대여차량 목록 */
		SELECT car.vin
			, car.vhcl_reg_no 
			, car.carmdl 
			, car.mdlyr
			, car.frst_reg_ymd 
			, car.expry_ymd 
			, car.crno 
		FROM
			dqvs.dvs_rac_mt_car car
		WHERE car.use_yn = 'Y'
<!-- 		ORDER BY frst_reg_ymd DESC -->
	</select>
</mapper>
